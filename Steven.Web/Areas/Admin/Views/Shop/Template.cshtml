@model List<ShopTemplate>
@{
    ViewBag.Title = "模板通知管理";
    long shopId = ViewBag.shopId;
}
@section headCss{
    <!-- 选择美化 -->
    <link href="/Res/admin/css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="/Res/admin/css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">
    <!-- Ladda style -->
    <link href="/Res/admin/css/plugins/ladda/ladda-themeless.min.css" rel="stylesheet">
}
@section footJs{
    <!-- Jquery Validate -->
    <script src="/Res/admin/js/plugins/validate/jquery.validate.min.js"></script>
    <script src="~/Res/admin/js/plugins/validate/messages_cn.js"></script>
    <!-- Ladda -->
    <script src="/Res/admin/js/plugins/ladda/spin.min.js"></script>
    <script src="/Res/admin/js/plugins/ladda/ladda.min.js"></script>
    <script src="/Res/admin/js/plugins/ladda/ladda.jquery.min.js"></script>

    <script src="~/Res/admin/js/CommonSubmit.js"></script>
    <script>
        var rules = {
            
        };
        var preSubmit = function () {
            doSetJson();
            return true;
        };
        commonSubmit('@Url.Action("EditTemplate")', '@ViewBag.ReUrl', 'saveForm', 'btnSave', rules, preSubmit);

    </script>
    <script>

        var doSetJson = function () {
            var arr = [];
            $("input[name='TemplateId']").each(function () {
                var templateId = $(this).val();
                var templateType = $(this).attr("data-type");
                arr.push({ TemplateType:templateType,  TemplateId: templateId });
            });
            $('#TemplateIds').val(JSON.stringify(arr));
            delete arr; arr = null;
        };
    </script>
}
<div class="row">
    <div class="col-lg-12">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h5>@ViewBag.Title</h5>
                <div class="ibox-tools">
                    <a class="collapse-link"> <i class="fa fa-chevron-up"></i> </a>
                    <a class="close-link"> <i class="fa fa-times"></i> </a>
                </div>
            </div>
            <div class="ibox-content">
                <form method="post" class="form-horizontal" id="saveForm">
                    @Html.AntiForgeryToken()
                    @Html.Hidden("shopId",shopId)
                    @Html.Hidden("TemplateIds")
                    <div class="form-group">
                        <div class="col-sm-11" id="templateList">
                            @foreach (var item in TemplateType.Closed.GetDescriptDict(TemplateType.WaitPay, TemplateType.Payed, TemplateType.Send, TemplateType.Take, TemplateType.Closed))
                            {
                                var templateId = string.Empty;
                                foreach (var shopTemplate in Model)
                                {
                                    if (item.Key == (short) shopTemplate.TemplateType)
                                    {
                                        templateId = shopTemplate.TemplateId;
                                    }
                                }
                                <div class="row pt10">
                                    <div class="col-sm-2">
                                       @(item.Value)：
                                    </div>
                                    <div class="col-sm-5">
                                        <input type="text" value="@templateId" data-type="@item.Key" placeholder="请输入微信模板ID" name="TemplateId" required class="form-control TemplateId" />
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                    <div class="hr-line-dashed"></div>
                    <div class="form-group">
                        <div class="col-sm-11 col-sm-offset-2">
                            <a class="btn btn-white" href="@ViewBag.ReUrl">返回</a>
                            <button class="btn btn-primary" type="button" id="btnSave">保存</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

